package commands

import (
	"github.com/dotcommander/gokart/cli"
{{- if or .UseSQLite .UseAI }}
	"github.com/spf13/cobra"
	"{{.Module}}/internal/app"
{{- end }}
)

{{- if or .UseSQLite .UseAI }}

var appCtx *app.Context
{{- end }}

// Execute runs the CLI application.
func Execute() error {
	cliApp := cli.NewApp("{{.Name}}", "0.1.0").
		WithDescription("{{.Name}} - a GoKart CLI application"){{if or .UseSQLite .UseAI}}.
		WithEnvPrefix("{{.Name | upper}}").
		WithStandardFlags()

	// Initialize context after config is loaded
	cliApp.Root().PersistentPreRunE = func(cmd *cobra.Command, args []string) error {
		var err error
		appCtx, err = app.New("{{.Name}}", cliApp.Viper())
		return err
	}

	// Cleanup on exit
	defer func() {
		if appCtx != nil {
			appCtx.Close()
		}
	}(){{end}}

	cliApp.AddCommand(NewGreetCmd())

	return cliApp.Run()
}
